# Democracy Satisfaction Harmonization Specification (v2)
# Variables: dem_sat_national, gov_sat_national, hh_income_sat

missing_conventions:
  treat_as_na:
    codes: [-1, 0, 7, 8, 9]
    description: "Standard missing codes"

variables:
  # ============================================================================
  # Satisfaction with how democracy works
  # ============================================================================
  - id: dem_sat_national
    concept: democracy_satisfaction
    description: "Satisfaction with the way democracy works in the country"
    type: ordinal
    
    source:
      w1: q098
      w2: q93
      w3: q89
      w4: q92
      w5: q99
      w6: q90
    
    scale:
      min: 1
      max: 4
      labels:
        1: "Not at all satisfied"
        2: "Not very satisfied"
        3: "Fairly satisfied"
        4: "Very satisfied"
    
    harmonize:
      default:
        method: identity
      exceptions:
        w1:
          method: r_function
          fn: safe_reverse_4pt
        w2:
          method: r_function
          fn: safe_reverse_4pt
    
    qc:
      valid_range: [1, 4]
      validate:
        - waves: [w1, w2]
          phrase: "democracy"
        - waves: [w3, w4, w5, w6]
          phrase: "democracy"

  # ============================================================================
  # Satisfaction with government
  # ============================================================================
  - id: gov_sat_national
    concept: government_satisfaction
    description: "Satisfaction with government's handling of key issues"
    type: ordinal
    
    source:
      w1: q104
      w2: q96
      w3: q91
      w4: q94
      w5: q102
      w6: q88
    
    scale:
      min: 1
      max: 4
      labels:
        1: "Not at all satisfied"
        2: "Not very satisfied"
        3: "Fairly satisfied"
        4: "Very satisfied"
    
    harmonize:
      default:
        method: identity
      exceptions:
        w1:
          method: identity
          note: "W1 has 5pt scale - confirm if collapsing to 4pt is appropriate"
        w2:
          method: r_function
          fn: safe_reverse_4pt
    
    qc:
      valid_range: [1, 4]
      validate:
        - waves: [w1]
          phrase: "government"
          note: "W1 has 5pt scale (1-5)"
        - waves: [w2, w3, w4, w5, w6]
          phrase: "government"

  # ============================================================================
  # Household income satisfaction
  # ============================================================================
  - id: hh_income_sat
    concept: household_income_satisfaction
    description: "Satisfaction with household income"
    type: ordinal
    
    source:
      w1: se9a
      w2: se9a
      w3: se9a
      w4: se9a
      w5: se9a
      w6: SE14a
    
    scale:
      min: 1
      max: 4
      labels:
        1: "Very dissatisfied"
        2: "Fairly dissatisfied"
        3: "Fairly satisfied"
        4: "Very satisfied"
    
    harmonize:
      default:
        method: identity
      exceptions:
        w6:
          method: identity
          note: "Variable name changed (se9a â†’ SE14a) - verify scale consistency"
    
    qc:
      valid_range: [1, 4]
      validate:
        - waves: [w1, w2, w3, w4, w5]
          phrase: "income|satisfaction"
        - waves: [w6]
          phrase: "income|satisfaction"
          note: "Variable name/scale may differ from w1-w5 - manual review recommended"
