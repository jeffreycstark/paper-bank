---
title: "ABS Longitudinal Trends: The Satisfaction Paradox (South Korea)"
format:
  html:
    toc: true
    toc-depth: 3
    number-sections: true
    theme: cosmo
    code-fold: true
execute:
  echo: true
  warning: false
  message: false
  cache: true
---

```{r setup}
library(tidyverse)
library(patchwork)
library(scales)
library(kableExtra)

project_root <- "/Users/jeffreystark/Development/Research/econdev-authpref"
source(file.path(project_root, "_data_config.R"))

paper_dir    <- file.path(project_root, "papers/south-korea-hollow-satisfaction")
analysis_dir <- file.path(paper_dir, "analysis")
fig_dir      <- file.path(analysis_dir, "figures")
results_dir  <- file.path(analysis_dir, "results")

# ── Wave year lookup ───────────────────────────────────────────────────────────
wave_years <- c("1" = 2003, "2" = 2006, "3" = 2011,
                "4" = 2015, "5" = 2019, "6" = 2022)

# ── Political event timeline ──────────────────────────────────────────────────
# Key events relevant to the satisfaction paradox narrative
events <- tribble(
  ~year,   ~label,                               ~vjust,
  2008.0,  "Global financial\ncrisis",            1.2,
  2016.92, "Park impeachment\nvote",              1.2,
  2017.25, "Constitutional\nCourt ruling",        2.6,
  2017.5,  "Moon elected",                        4.0
)

# ── Shared colour palette ─────────────────────────────────────────────────────
# Blue = satisfaction / economic (output legitimacy axis)
# Red  = democratic quality (input legitimacy axis)
# Greens / greys for secondary series
col_sat    <- "#2166AC"  # satisfaction (blue)
col_qual   <- "#D6604D"  # quality perception (red-orange)
col_econ   <- "#4DAF4A"  # economic evaluation (green)
col_part   <- "#984EA3"  # participation (purple)
col_acc    <- "#FF7F00"  # accountability (amber)
col_trust  <- "#878787"  # trust (grey)
col_shade  <- "#F7F7F7"  # background shading

theme_paper <- theme_bw(base_size = 12) +
  theme(
    panel.grid.minor  = element_blank(),
    legend.position   = "bottom",
    plot.title        = element_text(size = 11, face = "bold"),
    plot.caption      = element_text(size = 8, color = "grey40"),
    strip.background  = element_rect(fill = "grey92"),
    legend.key.width  = unit(1.5, "cm")
  )
```

```{r load-data}
kor <- readRDS(file.path(analysis_dir, "kor_abs.rds"))

cat("ABS Korea loaded: n =", nrow(kor),
    "| waves:", paste(sort(unique(kor$wave)), collapse = " "), "\n")
cat("Survey years:", paste(wave_years, collapse = ", "), "\n")
```

# Core Dissociation: Satisfaction vs. Quality {#sec-dissociation}

The central empirical claim is that democratic satisfaction diverges from democratic quality
perception over the ABS observation window. This section documents that divergence.

## Wave means: satisfaction and quality clusters

```{r sat-qual-means}
# ── Satisfaction cluster wave means ───────────────────────────────────────────
sat_means <- kor |>
  select(wave, survey_year, weight, sat_democracy, sat_govt) |>
  pivot_longer(starts_with("sat_"), names_to = "variable", values_to = "value") |>
  filter(!is.na(value)) |>
  group_by(wave, survey_year, variable) |>
  summarise(
    mean = weighted.mean(value, weight, na.rm = TRUE),
    se   = sd(value, na.rm = TRUE) / sqrt(n()),
    n    = n(),
    .groups = "drop"
  ) |>
  mutate(
    cluster = "Satisfaction",
    label   = recode(variable,
      sat_democracy = "Satisfaction with democracy",
      sat_govt      = "Satisfaction with national government"
    )
  )

# ── Quality cluster wave means ────────────────────────────────────────────────
qual_means <- kor |>
  select(wave, survey_year, weight,
         qual_extent, qual_pref_dem,
         qual_no_change_needed, qual_system_support) |>
  pivot_longer(starts_with("qual_"), names_to = "variable", values_to = "value") |>
  filter(!is.na(value)) |>
  group_by(wave, survey_year, variable) |>
  summarise(
    mean = weighted.mean(value, weight, na.rm = TRUE),
    se   = sd(value, na.rm = TRUE) / sqrt(n()),
    n    = n(),
    .groups = "drop"
  ) |>
  mutate(
    cluster = "Democratic quality",
    label   = recode(variable,
      qual_extent           = "Current democratic extent",
      qual_pref_dem         = "Democracy always preferable",
      qual_no_change_needed = "System does not need major change",
      qual_system_support   = "System deserves support"
    )
  )

# ── Cluster summary means (for the core dissociation plot) ───────────────────
sat_cluster <- sat_means |>
  group_by(wave, survey_year, cluster) |>
  summarise(mean = mean(mean), se = mean(se), .groups = "drop")

qual_cluster <- qual_means |>
  group_by(wave, survey_year, cluster) |>
  summarise(mean = mean(mean), se = mean(se), .groups = "drop")

cat("=== Satisfaction cluster wave means ===\n")
sat_cluster |> mutate(mean = round(mean, 3)) |> print()

cat("\n=== Democratic quality cluster wave means ===\n")
qual_cluster |> mutate(mean = round(mean, 3)) |> print()
```

## OLS trend slopes

```{r slopes}
# Estimate linear slope across survey_year (not wave number) for each variable.
# Slope is in normalized units per year; multiply × 10 for "per decade" interpretation.

estimate_slope <- function(df, value_col = "mean", time_col = "survey_year") {
  df |>
    group_by(variable, cluster, label) |>
    summarise(
      slope   = coef(lm(reformulate(time_col, value_col), data = cur_data()))[[2]],
      n_waves = n(),
      .groups = "drop"
    ) |>
    mutate(slope_per_decade = slope * 10)
}

sat_slopes  <- estimate_slope(sat_means)
qual_slopes <- estimate_slope(qual_means)

all_slopes <- bind_rows(sat_slopes, qual_slopes) |>
  arrange(cluster, slope)

cat("=== Trend slopes (normalized units per year) ===\n")
all_slopes |>
  mutate(across(c(slope, slope_per_decade), ~ round(.x, 4))) |>
  print()
```

## Figure 1: Core dissociation plot

```{r fig1-dissociation, fig.width=7, fig.height=5}
dissociation_data <- bind_rows(sat_cluster, qual_cluster) |>
  mutate(cluster = factor(cluster, levels = c("Satisfaction", "Democratic quality")))

fig1 <- ggplot(dissociation_data,
               aes(x = survey_year, y = mean,
                   color = cluster, group = cluster,
                   ymin = mean - 1.96 * se, ymax = mean + 1.96 * se)) +
  geom_ribbon(aes(fill = cluster), alpha = 0.12, color = NA) +
  geom_line(linewidth = 0.9) +
  geom_point(size = 2.8) +
  # Impeachment event line
  geom_vline(xintercept = 2016.92, linetype = "dashed",
             color = "grey50", linewidth = 0.5) +
  annotate("text", x = 2017.2, y = 0.75,
           label = "Park\nimpeachment", hjust = 0, size = 2.8, color = "grey40") +
  scale_color_manual(values = c("Satisfaction" = col_sat,
                                "Democratic quality" = col_qual)) +
  scale_fill_manual(values  = c("Satisfaction" = col_sat,
                                "Democratic quality" = col_qual)) +
  scale_x_continuous(breaks = as.numeric(wave_years),
                     labels = as.numeric(wave_years)) +
  scale_y_continuous(limits = c(0, 1),
                     labels = scales::label_percent(),
                     name   = "Mean (normalized scale, 0–1)") +
  labs(
    x       = NULL,
    color   = NULL, fill = NULL,
    title   = "The satisfaction paradox: diverging trends in democratic satisfaction\nand democratic quality perception, South Korea 2003–2022",
    caption = paste0("Wave means (weighted) with 95% CIs. Satisfaction cluster: mean of sat_democracy + sat_govt.\n",
                     "Quality cluster: mean of dem_extent_current, current govt rating, dem_always_preferable,\n",
                     "system change needed (reversed), system support. All variables normalized 0–1.\n",
                     "Source: ABS Korea, waves 1–6.")
  ) +
  theme_paper

fig1

ggsave(file.path(fig_dir, "fig1_satisfaction_quality_dissociation.png"),
       fig1, width = 7, height = 5, dpi = 300)
ggsave(file.path(fig_dir, "fig1_satisfaction_quality_dissociation.pdf"),
       fig1, width = 7, height = 5)
```

## Figure 2: Variable-level detail within each cluster

```{r fig2-cluster-detail, fig.width=8.5, fig.height=7}
detail_data <- bind_rows(sat_means, qual_means) |>
  mutate(cluster = factor(cluster, levels = c("Satisfaction", "Democratic quality")))

fig2 <- ggplot(detail_data,
               aes(x = survey_year, y = mean,
                   color = label, group = label,
                   ymin = mean - 1.96 * se, ymax = mean + 1.96 * se)) +
  geom_ribbon(aes(fill = label), alpha = 0.08, color = NA) +
  geom_line(linewidth = 0.7) +
  geom_point(size = 2) +
  geom_vline(xintercept = 2016.92, linetype = "dashed",
             color = "grey60", linewidth = 0.4) +
  scale_x_continuous(breaks = c(2003, 2011, 2019),
                     labels = c(2003, 2011, 2019)) +
  scale_y_continuous(limits = c(0, 1), labels = scales::label_percent()) +
  facet_wrap(~cluster, ncol = 2) +
  labs(
    x     = NULL,
    y     = "Mean (normalized 0–1)",
    color = NULL, fill = NULL,
    title = "Satisfaction and quality cluster components, South Korea ABS waves 1–6",
    caption = "Source: ABS Korea. Weighted wave means with 95% CIs."
  ) +
  theme_paper +
  theme(legend.position = "right",
        legend.text     = element_text(size = 8))

fig2

ggsave(file.path(fig_dir, "fig2_cluster_components.png"),
       fig2, width = 8.5, height = 7, dpi = 300)
ggsave(file.path(fig_dir, "fig2_cluster_components.pdf"),
       fig2, width = 8.5, height = 7)
```

---

# Economic Evaluations {#sec-econ}

The output legitimacy argument requires that economic evaluations track satisfaction
more closely than they track quality perception.

## Wave means: economic cluster

```{r econ-means}
econ_vars <- c("econ_national", "econ_hh_now", "econ_hh_change",
               "econ_hh_sat", "econ_outlook", "econ_hh_outlook", "econ_status")

econ_means <- kor |>
  select(wave, survey_year, weight, all_of(econ_vars)) |>
  pivot_longer(all_of(econ_vars), names_to = "variable", values_to = "value") |>
  filter(!is.na(value)) |>
  group_by(wave, survey_year, variable) |>
  summarise(
    mean = weighted.mean(value, weight, na.rm = TRUE),
    se   = sd(value, na.rm = TRUE) / sqrt(n()),
    n    = n(),
    .groups = "drop"
  ) |>
  mutate(
    cluster = "Economic evaluations",
    label   = recode(variable,
      econ_national    = "National economic conditions (now)",
      econ_hh_now      = "Household economic conditions (now)",
      econ_hh_change   = "Household economic conditions (change)",
      econ_hh_sat      = "Household income satisfaction",
      econ_outlook     = "National economic outlook (next year)",
      econ_hh_outlook  = "Household economic outlook (next year)",
      econ_status      = "Subjective social status (1–10)"
    )
  )

econ_cluster <- econ_means |>
  group_by(wave, survey_year, cluster) |>
  summarise(mean = mean(mean), se = mean(se), .groups = "drop")

cat("=== Economic cluster wave means ===\n")
econ_cluster |> mutate(mean = round(mean, 3)) |> print()
```

## Figure 3: Economic + satisfaction co-movement vs. quality

```{r fig3-econ-sat-qual, fig.width=7, fig.height=5}
three_cluster <- bind_rows(sat_cluster, qual_cluster, econ_cluster) |>
  mutate(cluster = factor(cluster,
    levels = c("Satisfaction", "Economic evaluations", "Democratic quality")))

fig3 <- ggplot(three_cluster,
               aes(x = survey_year, y = mean,
                   color = cluster, group = cluster,
                   ymin = mean - 1.96 * se, ymax = mean + 1.96 * se)) +
  geom_ribbon(aes(fill = cluster), alpha = 0.10, color = NA) +
  geom_line(linewidth = 0.9) +
  geom_point(size = 2.8) +
  geom_vline(xintercept = 2016.92, linetype = "dashed",
             color = "grey50", linewidth = 0.5) +
  annotate("text", x = 2017.2, y = 0.82,
           label = "Impeachment", hjust = 0, size = 2.8, color = "grey40") +
  scale_color_manual(values = c(
    "Satisfaction"          = col_sat,
    "Economic evaluations"  = col_econ,
    "Democratic quality"    = col_qual
  )) +
  scale_fill_manual(values = c(
    "Satisfaction"          = col_sat,
    "Economic evaluations"  = col_econ,
    "Democratic quality"    = col_qual
  )) +
  scale_x_continuous(breaks = as.numeric(wave_years),
                     labels = as.numeric(wave_years)) +
  scale_y_continuous(limits = c(0, 1), labels = scales::label_percent()) +
  labs(
    x       = NULL,
    y       = "Mean (normalized 0–1)",
    color   = NULL, fill = NULL,
    title   = "Output legitimacy: economic evaluations track satisfaction,\nnot democratic quality perception",
    caption = "Weighted wave means with 95% CIs. Cluster indices are means of normalized component variables.\nSource: ABS Korea, waves 1–6."
  ) +
  theme_paper

fig3

ggsave(file.path(fig_dir, "fig3_econ_sat_quality.png"),
       fig3, width = 7, height = 5, dpi = 300)
ggsave(file.path(fig_dir, "fig3_econ_sat_quality.pdf"),
       fig3, width = 7, height = 5)
```

---

# Institutional Trust Collapse {#sec-trust}

## Wave means: trust by institution

```{r trust-means}
trust_means <- kor |>
  select(wave, survey_year, weight,
         trust_govt, trust_parliament, trust_courts,
         trust_parties, trust_military, trust_press) |>
  pivot_longer(starts_with("trust_"), names_to = "variable", values_to = "value") |>
  filter(!is.na(value)) |>
  group_by(wave, survey_year, variable) |>
  summarise(
    mean = weighted.mean(value, weight, na.rm = TRUE),
    se   = sd(value, na.rm = TRUE) / sqrt(n()),
    n    = n(),
    .groups = "drop"
  ) |>
  mutate(
    label = recode(variable,
      trust_govt       = "National government",
      trust_parliament = "Parliament",
      trust_courts     = "Courts",
      trust_parties    = "Political parties",
      trust_military   = "Military",
      trust_press      = "Newspapers"
    ),
    inst_type = case_when(
      variable %in% c("trust_govt")                          ~ "Executive",
      variable %in% c("trust_parliament", "trust_parties")   ~ "Horizontal/accountability",
      variable %in% c("trust_courts")                        ~ "Judicial",
      variable %in% c("trust_press")                         ~ "Media",
      variable == "trust_military"                           ~ "Military"
    )
  )

cat("=== Trust wave means by institution ===\n")
trust_means |>
  select(wave, survey_year, label, mean) |>
  mutate(mean = round(mean, 3)) |>
  pivot_wider(names_from = label, values_from = mean) |>
  print()
```

## Figure 4: Trust trajectories by institution

```{r fig4-trust, fig.width=7.5, fig.height=5.5}
fig4 <- ggplot(trust_means,
               aes(x = survey_year, y = mean,
                   color = label, group = label,
                   ymin = mean - 1.96 * se, ymax = mean + 1.96 * se)) +
  geom_ribbon(aes(fill = label), alpha = 0.08, color = NA) +
  geom_line(linewidth = 0.7) +
  geom_point(size = 2.2) +
  geom_vline(xintercept = 2016.92, linetype = "dashed",
             color = "grey50", linewidth = 0.4) +
  scale_x_continuous(breaks = c(2003, 2011, 2019),
                     labels = c(2003, 2011, 2019)) +
  scale_y_continuous(limits = c(0, 1), labels = scales::label_percent()) +
  labs(
    x       = NULL,
    y       = "Mean trust (normalized 0–1)",
    color   = NULL, fill = NULL,
    title   = "Institutional trust collapse by institution, South Korea 2003–2022",
    caption = "Weighted wave means with 95% CIs. Source: ABS Korea, waves 1–6."
  ) +
  theme_paper

fig4

ggsave(file.path(fig_dir, "fig4_trust_trajectories.png"),
       fig4, width = 7.5, height = 5.5, dpi = 300)
ggsave(file.path(fig_dir, "fig4_trust_trajectories.pdf"),
       fig4, width = 7.5, height = 5.5)
```

---

# Accountability and Responsiveness {#sec-accountability}

## Wave means: accountability cluster

```{r acc-means}
acc_means <- kor |>
  select(wave, survey_year, weight,
         acc_transparency, acc_responsive, acc_elections,
         acc_courts, acc_free_speech) |>
  pivot_longer(starts_with("acc_"), names_to = "variable", values_to = "value") |>
  filter(!is.na(value)) |>
  group_by(wave, survey_year, variable) |>
  summarise(
    mean = weighted.mean(value, weight, na.rm = TRUE),
    se   = sd(value, na.rm = TRUE) / sqrt(n()),
    n    = n(),
    .groups = "drop"
  ) |>
  mutate(
    cluster = "Accountability",
    label   = recode(variable,
      acc_transparency = "Government transparency (reversed)",
      acc_responsive   = "Government responsiveness to citizens",
      acc_elections    = "Elections free and fair",
      acc_courts       = "Courts independent of political leaders (reversed)",
      acc_free_speech  = "Freedom of speech"
    )
  )

cat("=== Accountability cluster wave means ===\n")
acc_means |>
  select(wave, survey_year, label, mean) |>
  mutate(mean = round(mean, 3)) |>
  print()
```

## Figure 5: Accountability perceptions over time

```{r fig5-accountability, fig.width=7.5, fig.height=5.5}
fig5 <- ggplot(acc_means,
               aes(x = survey_year, y = mean,
                   color = label, group = label,
                   ymin = mean - 1.96 * se, ymax = mean + 1.96 * se)) +
  geom_ribbon(aes(fill = label), alpha = 0.08, color = NA) +
  geom_line(linewidth = 0.7) +
  geom_point(size = 2.2) +
  geom_vline(xintercept = 2016.92, linetype = "dashed",
             color = "grey50", linewidth = 0.4) +
  scale_x_continuous(breaks = c(2003, 2011, 2019),
                     labels = c(2003, 2011, 2019)) +
  scale_y_continuous(limits = c(0, 1), labels = scales::label_percent()) +
  labs(
    x       = NULL,
    y       = "Mean (normalized 0–1, higher = more accountable)",
    color   = NULL, fill = NULL,
    title   = "Accountability and responsiveness perceptions, South Korea 2003–2022",
    caption = paste0("Reversed variables: govt_withholds_info, gov_courts_powerless ",
                     "(higher = more transparent / more independent).\n",
                     "Weighted wave means with 95% CIs. Source: ABS Korea, waves 1–6.")
  ) +
  theme_paper +
  theme(legend.text = element_text(size = 8))

fig5

ggsave(file.path(fig_dir, "fig5_accountability.png"),
       fig5, width = 7.5, height = 5.5, dpi = 300)
ggsave(file.path(fig_dir, "fig5_accountability.pdf"),
       fig5, width = 7.5, height = 5.5)
```

---

# Political Participation {#sec-participation}

## Wave means: participation cluster

```{r part-means}
part_means <- kor |>
  select(wave, survey_year, weight,
         part_voted, part_petition, part_demonstration,
         part_contact, part_efficacy_int, part_efficacy_ext) |>
  pivot_longer(starts_with("part_"), names_to = "variable", values_to = "value") |>
  filter(!is.na(value)) |>
  group_by(wave, survey_year, variable) |>
  summarise(
    mean = weighted.mean(value, weight, na.rm = TRUE),
    se   = sd(value, na.rm = TRUE) / sqrt(n()),
    n    = n(),
    .groups = "drop"
  ) |>
  mutate(
    cluster = "Participation",
    label   = recode(variable,
      part_voted         = "Voted in last election",
      part_petition      = "Signed petition",
      part_demonstration = "Participated in demonstration",
      part_contact       = "Contacted elected official",
      part_efficacy_int  = "Internal political efficacy",
      part_efficacy_ext  = "External political efficacy (reversed)"
    ),
    type = if_else(variable %in% c("part_efficacy_int", "part_efficacy_ext"),
                   "Efficacy", "Action")
  )

cat("=== Participation cluster wave means ===\n")
part_means |>
  select(wave, survey_year, label, mean) |>
  mutate(mean = round(mean, 3)) |>
  print()
```

## Figure 6: Participation and efficacy

```{r fig6-participation, fig.width=8, fig.height=5.5}
fig6 <- ggplot(part_means,
               aes(x = survey_year, y = mean,
                   color = label, group = label,
                   ymin = mean - 1.96 * se, ymax = mean + 1.96 * se)) +
  geom_ribbon(aes(fill = label), alpha = 0.08, color = NA) +
  geom_line(linewidth = 0.7) +
  geom_point(size = 2.2) +
  geom_vline(xintercept = 2016.92, linetype = "dashed",
             color = "grey50", linewidth = 0.4) +
  scale_x_continuous(breaks = c(2003, 2011, 2019),
                     labels = c(2003, 2011, 2019)) +
  scale_y_continuous(limits = c(0, 1), labels = scales::label_percent()) +
  facet_wrap(~type, ncol = 2) +
  labs(
    x       = NULL,
    y       = "Mean (normalized 0–1)",
    color   = NULL, fill = NULL,
    title   = "Political participation and efficacy, South Korea 2003–2022",
    caption = "Weighted wave means with 95% CIs. Source: ABS Korea, waves 1–6."
  ) +
  theme_paper +
  theme(legend.text = element_text(size = 8))

fig6

ggsave(file.path(fig_dir, "fig6_participation.png"),
       fig6, width = 8, height = 5.5, dpi = 300)
ggsave(file.path(fig_dir, "fig6_participation.pdf"),
       fig6, width = 8, height = 5.5)
```

---

# Full Cross-Cluster Slope Summary {#sec-slopes}

All five clusters in one table, sorted by direction and magnitude.

```{r all-cluster-slopes}
econ_slopes <- estimate_slope(econ_means)
acc_slopes  <- estimate_slope(acc_means)
part_slopes <- estimate_slope(part_means)
trust_slopes <- estimate_slope(
  trust_means |> rename(cluster = inst_type)
)

all_cluster_slopes <- bind_rows(
  sat_slopes, qual_slopes, econ_slopes, acc_slopes, part_slopes
) |>
  arrange(cluster, slope) |>
  mutate(
    direction = if_else(slope > 0, "↑ Increasing", "↓ Decreasing"),
    slope_per_decade = round(slope_per_decade, 3)
  )

all_cluster_slopes |>
  select(cluster, label, slope_per_decade, direction) |>
  kable(
    caption = "Linear trend slopes by variable (normalized units per decade, OLS)",
    col.names = c("Cluster", "Variable", "Slope/decade", "Direction")
  ) |>
  kable_styling(bootstrap_options = c("striped", "hover"), font_size = 11) |>
  collapse_rows(columns = 1, valign = "top")
```

---

# Save Results {#sec-save}

```{r save-results}
saveRDS(sat_means,         file.path(results_dir, "sat_means.rds"))
saveRDS(qual_means,        file.path(results_dir, "qual_means.rds"))
saveRDS(econ_means,        file.path(results_dir, "econ_means.rds"))
saveRDS(acc_means,         file.path(results_dir, "acc_means.rds"))
saveRDS(part_means,        file.path(results_dir, "part_means.rds"))
saveRDS(trust_means,       file.path(results_dir, "trust_means.rds"))

saveRDS(sat_cluster,       file.path(results_dir, "sat_cluster.rds"))
saveRDS(qual_cluster,      file.path(results_dir, "qual_cluster.rds"))
saveRDS(econ_cluster,      file.path(results_dir, "econ_cluster.rds"))
saveRDS(three_cluster,     file.path(results_dir, "three_cluster.rds"))

saveRDS(all_cluster_slopes, file.path(results_dir, "all_cluster_slopes.rds"))

cat("✓ All results saved to", results_dir, "\n")
```
