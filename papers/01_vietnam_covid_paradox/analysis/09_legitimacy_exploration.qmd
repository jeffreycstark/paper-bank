---
title: "Legitimacy Exploration Analysis"
subtitle: "Political Attitudes, Blind Loyalty, and Alternative Mechanisms"
author: "Asian Barometer Research Project"
date: today
format:
  html:
    toc: true
    toc-depth: 3
    code-fold: true
    code-summary: "Show code"
    number-sections: true
execute:
  echo: true
  warning: false
  message: false
---

```{r}
#| label: setup
#| include: false

library(tidyverse)
library(here)
library(gt)
library(corrplot)
library(patchwork)
library(broom)
library(modelsummary)

# Load data with new political attitude variables
ab_analysis <- readRDS(here("papers", "01_vietnam_covid_paradox", "analysis", "data", "analysis_data.rds"))

# Focus on three-country comparison
ab_three <- ab_analysis %>%
  filter(country_name %in% c("Vietnam", "Cambodia", "Thailand"))

# Color palette for countries
country_colors <- c(

  "Vietnam" = "#E41A1C",
  "Cambodia" = "#377EB8",
  "Thailand" = "#4DAF4A"
)
```

# Overview

This analysis explores alternative mechanisms for the Vietnam Paradox using newly created political attitude variables:

**Political Attitudes (4-point scales, higher = more positive view of government):**

- `blind_loyalty`: Belief citizens should always support government
- `trust_govt_officials`: Trust that officials act in citizens' interests
- `govt_responsiveness`: Perception government responds to public wants
- `govt_transparency`: Perception of government information openness (5-point)
- `govt_satisfaction`: Satisfaction with how government runs the country
- `system_support`: Belief that current system of government is best

**Democracy Preference (binary indicators from q124):**

- `democracy_committed`: Democracy is always preferable (vs. other views)
- `authoritarian_acceptable`: Authoritarian rule can be preferable
- `regime_indifferent`: Doesn't matter what kind of government

# Descriptive Statistics by Country

## Mean and SD for Political Attitude Variables

```{r}
#| label: tbl-descriptives
#| tbl-cap: "Political Attitude Variables by Country"

# Define political attitude variables
political_vars <- c(
  "blind_loyalty", "trust_govt_officials", "govt_responsiveness",
  "govt_transparency", "govt_satisfaction", "system_support"
)

# Calculate means and SDs by country
descriptives <- ab_three %>%
  group_by(country_name) %>%
  summarise(
    n = n(),
    across(
      all_of(political_vars),
      list(
        mean = ~round(mean(., na.rm = TRUE), 2),
        sd = ~round(sd(., na.rm = TRUE), 2)
      ),
      .names = "{.col}_{.fn}"
    ),
    .groups = "drop"
  )

# Reshape for display
descriptives_long <- descriptives %>%
  pivot_longer(
    cols = -c(country_name, n),
    names_to = c("variable", "stat"),
    names_pattern = "(.*)_(mean|sd)",
    values_to = "value"
  ) %>%
  pivot_wider(
    names_from = stat,
    values_from = value
  ) %>%
  mutate(
    display = paste0(mean, " (", sd, ")"),
    variable = case_when(
      variable == "blind_loyalty" ~ "Blind Loyalty",
      variable == "trust_govt_officials" ~ "Trust Govt Officials",
      variable == "govt_responsiveness" ~ "Govt Responsiveness",
      variable == "govt_transparency" ~ "Govt Transparency",
      variable == "govt_satisfaction" ~ "Govt Satisfaction",
      variable == "system_support" ~ "System Support",
      TRUE ~ variable
    )
  ) %>%
  select(country_name, variable, display) %>%
  pivot_wider(
    names_from = country_name,
    values_from = display
  )

descriptives_long %>%
  gt() %>%
  tab_header(
    title = "Political Attitudes by Country",
    subtitle = "Mean (SD), higher values = more pro-government"
  ) %>%
  cols_label(
    variable = "Variable"
  ) %>%
  tab_footnote(
    footnote = "All scales 1-4 except Govt Transparency (1-5)"
  )
```

## Democracy Preference Distribution

```{r}
#| label: tbl-dem-pref
#| tbl-cap: "Democracy Preference by Country"

dem_pref <- ab_three %>%
  group_by(country_name) %>%
  summarise(
    n = n(),
    pct_committed = round(100 * mean(democracy_committed, na.rm = TRUE), 1),
    pct_auth_ok = round(100 * mean(authoritarian_acceptable, na.rm = TRUE), 1),
    pct_indifferent = round(100 * mean(regime_indifferent, na.rm = TRUE), 1),
    .groups = "drop"
  )

dem_pref %>%
  gt() %>%
  tab_header(
    title = "Democracy Preference Distribution",
    subtitle = "Percentage in each category"
  ) %>%
  cols_label(
    country_name = "Country",
    n = "N",
    pct_committed = "Democracy Always (%)",
    pct_auth_ok = "Authoritarian OK (%)",
    pct_indifferent = "Indifferent (%)"
  ) %>%
  fmt_number(columns = c(pct_committed, pct_auth_ok, pct_indifferent), decimals = 1)
```

## Stacked Bar Chart: Democracy Preferences

```{r}
#| label: fig-dem-pref
#| fig-cap: "Democracy Preference by Country"
#| fig-height: 5
#| fig-width: 8

# Prepare data for stacked bar chart using pre-created binary variables
dem_pref_long <- ab_three %>%
  filter(!is.na(democracy_committed) | !is.na(authoritarian_acceptable) | !is.na(regime_indifferent)) %>%
  mutate(
    dem_category = case_when(
      democracy_committed == 1 ~ "Democracy Always Preferable",
      authoritarian_acceptable == 1 ~ "Authoritarian Sometimes OK",
      regime_indifferent == 1 ~ "Doesn't Matter",
      TRUE ~ NA_character_
    ),
    dem_category = factor(
      dem_category,
      levels = c("Democracy Always Preferable", "Authoritarian Sometimes OK", "Doesn't Matter")
    )
  ) %>%
  filter(!is.na(dem_category))

# Calculate percentages
dem_pct <- dem_pref_long %>%
  count(country_name, dem_category) %>%
  group_by(country_name) %>%
  mutate(pct = 100 * n / sum(n)) %>%
  ungroup()

ggplot(dem_pct, aes(x = country_name, y = pct, fill = dem_category)) +
  geom_col(position = "stack", width = 0.7) +
  scale_fill_manual(
    values = c(
      "Democracy Always Preferable" = "#2166AC",
      "Authoritarian Sometimes OK" = "#D6604D",
      "Doesn't Matter" = "#999999"
    ),
    name = "Preference"
  ) +
  labs(
    x = NULL,
    y = "Percentage",
    title = "Democracy Preference by Country",
    subtitle = "Q124: Which of these statements comes closest to your view?"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    axis.text.x = element_text(size = 12, face = "bold"),
    panel.grid.major.x = element_blank()
  ) +
  geom_text(
    aes(label = paste0(round(pct, 0), "%")),
    position = position_stack(vjust = 0.5),
    color = "white",
    fontface = "bold",
    size = 4
  )
```

## Political Attitude Comparison Plot

```{r}
#| label: fig-attitudes
#| fig-cap: "Political Attitudes by Country"
#| fig-height: 6
#| fig-width: 10

# Prepare data for comparison plot
attitude_means <- ab_three %>%
  group_by(country_name) %>%
  summarise(
    across(
      all_of(political_vars),
      ~mean(., na.rm = TRUE)
    ),
    .groups = "drop"
  ) %>%
  pivot_longer(
    cols = -country_name,
    names_to = "variable",
    values_to = "mean"
  ) %>%
  mutate(
    variable_label = case_when(
      variable == "blind_loyalty" ~ "Blind\nLoyalty",
      variable == "trust_govt_officials" ~ "Trust Govt\nOfficials",
      variable == "govt_responsiveness" ~ "Govt\nResponsiveness",
      variable == "govt_transparency" ~ "Govt\nTransparency*",
      variable == "govt_satisfaction" ~ "Govt\nSatisfaction",
      variable == "system_support" ~ "System\nSupport"
    ),
    variable_label = factor(variable_label, levels = c(
      "Blind\nLoyalty", "Trust Govt\nOfficials", "Govt\nResponsiveness",
      "Govt\nTransparency*", "Govt\nSatisfaction", "System\nSupport"
    ))
  )

ggplot(attitude_means, aes(x = variable_label, y = mean, fill = country_name)) +
  geom_col(position = position_dodge(width = 0.8), width = 0.7) +
  scale_fill_manual(values = country_colors, name = "Country") +
  labs(
    x = NULL,
    y = "Mean Score",
    title = "Political Attitudes by Country",
    subtitle = "Higher values indicate more pro-government attitudes",
    caption = "*Govt Transparency on 5-point scale; others on 4-point scale"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    axis.text.x = element_text(size = 10),
    panel.grid.major.x = element_blank()
  ) +
  coord_cartesian(ylim = c(1, 4))
```

# Correlations with Existing Variables

```{r}
#| label: fig-correlations
#| fig-cap: "Correlation Matrix: Political Attitudes and Key Variables"
#| fig-height: 8
#| fig-width: 10

# Create correlation matrix
correlation_vars <- c(
  "blind_loyalty", "trust_govt_officials", "govt_responsiveness",
  "govt_transparency", "govt_satisfaction", "system_support",
  "democracy_committed", "authoritarian_acceptable", "regime_indifferent",
  "covid_govt_handling", "covid_trust_info", "dem_satisfaction",
  "institutional_trust_index"
)

# Check which variables exist and have valid data
available_vars <- correlation_vars[correlation_vars %in% names(ab_three)]

cor_data <- ab_three %>%
  select(all_of(available_vars)) %>%
  drop_na()

if (nrow(cor_data) > 50) {
  cor_matrix <- cor(cor_data, use = "pairwise.complete.obs")

  # Create better labels
  var_labels <- c(
    "blind_loyalty" = "Blind Loyalty",
    "trust_govt_officials" = "Trust Officials",
    "govt_responsiveness" = "Responsiveness",
    "govt_transparency" = "Transparency",
    "govt_satisfaction" = "Satisfaction",
    "system_support" = "System Support",
    "democracy_committed" = "Dem Committed",
    "authoritarian_acceptable" = "Auth OK",
    "regime_indifferent" = "Indifferent",
    "covid_govt_handling" = "COVID Handling (DV)",
    "covid_trust_info" = "Trust COVID Info",
    "dem_satisfaction" = "Dem Satisfaction",
    "institutional_trust_index" = "Inst Trust Index"
  )

  colnames(cor_matrix) <- var_labels[colnames(cor_matrix)]
  rownames(cor_matrix) <- var_labels[rownames(cor_matrix)]

  corrplot(
    cor_matrix,
    method = "color",
    type = "upper",
    order = "hclust",
    tl.col = "black",
    tl.srt = 45,
    tl.cex = 0.8,
    addCoef.col = "black",
    number.cex = 0.6,
    col = colorRampPalette(c("#B2182B", "white", "#2166AC"))(100),
    title = "Correlation Matrix",
    mar = c(0, 0, 2, 0)
  )
} else {
  cat("Insufficient data for correlation analysis")
}
```

## Correlation Table with Key DVs

```{r}
#| label: tbl-correlations
#| tbl-cap: "Correlations with COVID Handling and Trust"

# Calculate correlations with DV and mediator
key_cors <- ab_three %>%
  summarise(
    across(
      c(blind_loyalty, trust_govt_officials, govt_responsiveness,
        govt_transparency, govt_satisfaction, system_support),
      list(
        covid_handling = ~cor(., covid_govt_handling, use = "pairwise.complete.obs"),
        trust_info = ~cor(., covid_trust_info, use = "pairwise.complete.obs"),
        inst_trust = ~cor(., institutional_trust_index, use = "pairwise.complete.obs")
      ),
      .names = "{.col}_{.fn}"
    )
  ) %>%
  pivot_longer(
    everything(),
    names_to = c("variable", "outcome"),
    names_pattern = "(.*)_(covid_handling|trust_info|inst_trust)",
    values_to = "correlation"
  ) %>%
  pivot_wider(
    names_from = outcome,
    values_from = correlation
  ) %>%
  mutate(
    variable = case_when(
      variable == "blind_loyalty" ~ "Blind Loyalty",
      variable == "trust_govt_officials" ~ "Trust Govt Officials",
      variable == "govt_responsiveness" ~ "Govt Responsiveness",
      variable == "govt_transparency" ~ "Govt Transparency",
      variable == "govt_satisfaction" ~ "Govt Satisfaction",
      variable == "system_support" ~ "System Support"
    ),
    across(where(is.numeric), ~round(., 2))
  )

key_cors %>%
  gt() %>%
  tab_header(
    title = "Correlations: Political Attitudes with Key Variables"
  ) %>%
  cols_label(
    variable = "Political Attitude",
    covid_handling = "COVID Handling (DV)",
    trust_info = "Trust COVID Info",
    inst_trust = "Institutional Trust"
  ) %>%
  tab_source_note("Pearson correlations, pairwise complete observations")
```

# Key Exploratory Questions

## Q1: Does Government Transparency Predict Trust in COVID Info?

**Hypothesis**: If information environment matters, perceived transparency should predict trust in COVID information.

```{r}
#| label: tbl-q1
#| tbl-cap: "Does Transparency Predict Trust in COVID Information?"

# Model: covid_trust_info ~ govt_transparency + controls
model_q1 <- lm(
  covid_trust_info ~ govt_transparency + age + gender + educ_years + urban + country_name,
  data = ab_three
)

modelsummary(
  list("Trust COVID Info" = model_q1),
  stars = TRUE,
  gof_map = c("nobs", "r.squared", "adj.r.squared"),
  notes = "Controls: age, gender, education, urban, country FE"
)
```

```{r}
#| label: fig-q1
#| fig-cap: "Transparency and Trust in COVID Information by Country"
#| fig-height: 5
#| fig-width: 8

ggplot(ab_three, aes(x = govt_transparency, y = covid_trust_info, color = country_name)) +
  geom_jitter(alpha = 0.3, width = 0.2, height = 0.2) +
  geom_smooth(method = "lm", se = TRUE) +
  scale_color_manual(values = country_colors, name = "Country") +
  labs(
    x = "Perceived Government Transparency",
    y = "Trust in COVID Information",
    title = "Does Transparency Predict Trust in COVID Info?",
    subtitle = "Information environment story"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

## Q2: Does Blind Loyalty Explain Vietnam's Paradox?

**Hypothesis**: Vietnam's high approval despite high infections may be explained by blind loyalty to government rather than performance evaluation.

```{r}
#| label: tbl-q2
#| tbl-cap: "Does Blind Loyalty Explain Vietnam's High Approval?"

# Compare Vietnam mean on blind_loyalty
blind_loyalty_means <- ab_three %>%
  group_by(country_name) %>%
  summarise(
    mean_blind_loyalty = mean(blind_loyalty, na.rm = TRUE),
    mean_covid_handling = mean(covid_govt_handling, na.rm = TRUE),
    n = n()
  )

print(blind_loyalty_means)

# Model with interaction
model_q2 <- lm(
  covid_govt_handling ~ blind_loyalty * vietnam + age + gender + educ_years + urban,
  data = ab_three
)

modelsummary(
  list("COVID Handling" = model_q2),
  stars = TRUE,
  gof_map = c("nobs", "r.squared", "adj.r.squared"),
  notes = "Vietnam dummy interacted with blind loyalty"
)
```

```{r}
#| label: fig-q2
#| fig-cap: "Blind Loyalty and COVID Handling by Country"
#| fig-height: 5
#| fig-width: 8

ggplot(ab_three, aes(x = blind_loyalty, y = covid_govt_handling, color = country_name)) +
  geom_jitter(alpha = 0.3, width = 0.2, height = 0.2) +
  geom_smooth(method = "lm", se = TRUE) +
  scale_color_manual(values = country_colors, name = "Country") +
  labs(
    x = "Blind Loyalty to Government",
    y = "COVID Handling Approval",
    title = "Does Blind Loyalty Drive Approval?",
    subtitle = "Alternative mechanism hypothesis"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  facet_wrap(~country_name)
```

## Q3: Is System Support Driving Approval Independent of Performance?

**Hypothesis**: Diffuse support (system_support) may explain approval independent of performance evaluations.

```{r}
#| label: tbl-q3
#| tbl-cap: "System Support as Predictor of COVID Approval"

# Model comparing performance vs system support
model_q3a <- lm(
  covid_govt_handling ~ institutional_trust_index + age + gender + educ_years + urban + country_name,
  data = ab_three
)

model_q3b <- lm(
  covid_govt_handling ~ system_support + age + gender + educ_years + urban + country_name,
  data = ab_three
)

model_q3c <- lm(
  covid_govt_handling ~ institutional_trust_index + system_support + age + gender + educ_years + urban + country_name,
  data = ab_three
)

modelsummary(
  list(
    "Trust Only" = model_q3a,
    "System Support Only" = model_q3b,
    "Both" = model_q3c
  ),
  stars = TRUE,
  gof_map = c("nobs", "r.squared", "adj.r.squared"),
  notes = "All models include demographic controls and country FE"
)
```

## Q4: How Does Democracy Commitment Interact with Trust → Approval?

**Hypothesis**: The trust-approval relationship may differ between committed democrats and those open to authoritarianism.

```{r}
#| label: tbl-q4
#| tbl-cap: "Democracy Commitment as Moderator"

# Interaction model
model_q4 <- lm(
  covid_govt_handling ~ institutional_trust_index * democracy_committed +
    age + gender + educ_years + urban + country_name,
  data = ab_three
)

modelsummary(
  list("COVID Handling" = model_q4),
  stars = TRUE,
  gof_map = c("nobs", "r.squared", "adj.r.squared"),
  notes = "Trust × Democracy Committed interaction"
)
```

```{r}
#| label: fig-q4
#| fig-cap: "Trust-Approval Relationship by Democracy Commitment"
#| fig-height: 5
#| fig-width: 10

ab_three %>%
  filter(!is.na(democracy_committed)) %>%
  mutate(dem_label = if_else(democracy_committed == 1, "Committed Democrat", "Not Committed")) %>%
  ggplot(aes(x = institutional_trust_index, y = covid_govt_handling, color = dem_label)) +
  geom_jitter(alpha = 0.3, width = 0.1, height = 0.1) +
  geom_smooth(method = "lm", se = TRUE) +
  facet_wrap(~country_name) +
  scale_color_manual(
    values = c("Committed Democrat" = "#2166AC", "Not Committed" = "#D6604D"),
    name = "Democracy Preference"
  ) +
  labs(
    x = "Institutional Trust Index",
    y = "COVID Handling Approval",
    title = "Does Democracy Commitment Moderate Trust-Approval Link?",
    subtitle = "Separate slopes by democracy preference within each country"
  ) +
  theme_minimal() +
  theme(legend.position = "bottom")
```

# Robustness Check: Adding Diffuse Support Controls

**Key Test**: If trust effect holds after controlling for blind loyalty and system support, this strengthens the information-trust-approval argument.

```{r}
#| label: tbl-robustness
#| tbl-cap: "Robustness: Trust Effect After Controlling for Diffuse Support"

# Base model (replicating main analysis)
model_base <- lm(
  covid_govt_handling ~ covid_trust_info + institutional_trust_index +
    age + gender + educ_years + urban + country_name,
  data = ab_three
)

# Add blind loyalty
model_loyalty <- lm(
  covid_govt_handling ~ covid_trust_info + institutional_trust_index +
    blind_loyalty +
    age + gender + educ_years + urban + country_name,
  data = ab_three
)

# Add system support
model_system <- lm(
  covid_govt_handling ~ covid_trust_info + institutional_trust_index +
    system_support +
    age + gender + educ_years + urban + country_name,
  data = ab_three
)

# Full model with both
model_full <- lm(
  covid_govt_handling ~ covid_trust_info + institutional_trust_index +
    blind_loyalty + system_support +
    age + gender + educ_years + urban + country_name,
  data = ab_three
)

modelsummary(
  list(
    "Base" = model_base,
    "+ Blind Loyalty" = model_loyalty,
    "+ System Support" = model_system,
    "Full Model" = model_full
  ),
  stars = TRUE,
  coef_map = c(
    "covid_trust_info" = "Trust COVID Info",
    "institutional_trust_index" = "Institutional Trust",
    "blind_loyalty" = "Blind Loyalty",
    "system_support" = "System Support",
    "country_nameThailand" = "Thailand",
    "country_nameVietnam" = "Vietnam"
  ),
  gof_map = c("nobs", "r.squared", "adj.r.squared"),
  notes = list(
    "Base controls: age, gender, education, urban",
    "Reference country: Cambodia"
  )
)
```

## Interpretation of Robustness Results

```{r}
# Extract key coefficients for comparison
base_trust <- coef(model_base)["covid_trust_info"]
full_trust <- coef(model_full)["covid_trust_info"]
pct_change <- round(100 * (full_trust - base_trust) / base_trust, 1)

cat("Trust COVID Info coefficient comparison:\n")
cat("  Base model:", round(base_trust, 3), "\n")
cat("  Full model:", round(full_trust, 3), "\n")
cat("  Change:", pct_change, "%\n\n")

if (abs(pct_change) < 20) {
  cat("✓ Trust effect is ROBUST: Coefficient changes less than 20%\n")
  cat("  This supports the information-trust-approval mechanism\n")
  cat("  over a pure diffuse support explanation.\n")
} else {
  cat("⚠ Trust effect is substantially reduced\n")
  cat("  Diffuse support may account for some of the trust effect.\n")
}
```

# Summary of Findings

```{r}
#| label: tbl-summary
#| tbl-cap: "Summary of Exploratory Findings"

tibble(
  Question = c(
    "Q1: Transparency → COVID Trust",
    "Q2: Blind Loyalty → Approval",
    "Q3: System Support → Approval",
    "Q4: Democracy × Trust Interaction",
    "Robustness: Trust effect holds?"
  ),
  Finding = c(
    "See regression output above",
    "Vietnam highest on blind loyalty",
    "System support predicts approval",
    "See interaction plot",
    paste0("Trust coefficient change: ", pct_change, "%")
  ),
  Implication = c(
    "Information environment matters if significant",
    "Possible alternative mechanism",
    "Diffuse support contributes to approval",
    "Mechanism may vary by regime orientation",
    if_else(abs(pct_change) < 20, "Supports main argument", "Alternative mechanisms matter")
  )
) %>%
  gt() %>%
  tab_header(
    title = "Summary of Exploratory Findings"
  )
```

# Next Steps

Based on these exploratory findings, consider:

1. **If transparency → trust is significant**: Strengthen the information environment narrative
2. **If blind loyalty is strong in Vietnam**: Add as alternative explanation in discussion
3. **If trust effect is robust**: Main argument is well-supported
4. **If trust effect weakens**: Need to acknowledge role of diffuse support

---

*Analysis completed: `r Sys.Date()`*
